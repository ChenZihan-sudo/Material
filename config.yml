Default:
  absolute_work_dir: /home/catcolia/Material
  device: cuda
  result_path: results
  tune_result_path: tune_results
  dataset_dir: dataset

# Task
Process:
  raw_dir: "{{Default.absolute_work_dir}}/{{Default.dataset_dir}}/raw"
  processed_dir: "{{Default.absolute_work_dir}}/{{Default.dataset_dir}}/processed"
  max_cutoff_distance: 8.0
  max_cutoff_neighbors: 
  edge:
    normalization: true
    edge_feature: 30
    gaussian_smearing:
      enable: true
      resolution: "{{Process.edge.edge_feature}}"
      width: 0.2
  process: MPDataset

# Task
Training:
  model: ChemGNN
  epochs: 1000
  dataset:
    name: MPDataset # MPDataset;HypothesisDataset;OptimizedHypoDataset
    trainset_ratio: 0.8
    valset_ratio: 0.1
    testset_ratio: 0.1
    seed: 1
  data_loader:
    batch_size: 800
    num_workers: 1
    seed: 1
  save_best_model: true # get best model based on best test loss
  # save_step: 2 # save results every save_step epochs
  save_result_on: "{{Default.absolute_work_dir}}/{{Default.result_path}}"
  # load model from a checkpoint file, empty (blank) here will train from begin
  load_model_from: # "{{Default.absolute_work_dir}}/results/ChemGNN/1724537109002412"
  # resume training will restore all status and cover the original checkpoint file
  resume_training: true

# Task
Tuning:
  storage_path: "{{Default.absolute_work_dir}}/{{Default.tune_result_path}}/tune"
  log_to_file: true # log trainable output
  model: ChemGNN
  dataset:
    name: MPDataset # MPDataset;HypothesisDataset;OptimizedHypoDataset
    trainset_ratio: 0.8
    valset_ratio: 0.1
    testset_ratio: 0.1
    seed: 1
  data_loader:
    batch_size: 100
    num_workers: 1
    seed: 1
  save_loss_limit: 1.0 # data will start saving if the model loss reaches this value
  trial_num_samples: 100000000000
  max_concurrent_trials: 2
  max_epochs: 350
  time_budget_s: # the whole experiment will stop in time_budget_s seconds
  resources:
    num_cpus: 16 # total hardware cpu(thread) resources
    num_gpus: 1 # total hardware gpu resources
    trial_cpus: 16 # a trail uses cpus=num_cpus/trial_cpus if paralleled
    trial_gpus: 1 # a trial uses gpus=num_gpus/trial_gpus if paralleled
  # the trial will end if the best model does not appear after the `keep_best_epochs` epochs,
  # resetting the counter to 0 when the best model appears.
  keep_best_epochs: 100
  save_result_on: "{{Default.absolute_work_dir}}/{{Default.tune_result_path}}"
  # restore experiment from a experiment path, empty (blank) here will start training from begin
  restore_experiment_from: "{{Tuning.storage_path}}/ChemGNN_MPDataset_2024-08-27_09-53-22"
  # load dataset by trainable model method, produce the dataset processed data if need
  load_dataset_by_trainable: false

# Task
# Analysis:

Dataset:
  MPDataset: # Material Project
    raw_dir: "{{Process.raw_dir}}/mp"
    processed_dir: "{{Process.processed_dir}}/mp_neigbor_20_edge_30"
    api_key: j61NN3yuDh8tQWf0OrkachbbUoJ8npVP
    chunk_size: 1000
    num_chunks:
    keep_data_from: "{{Dataset.MPDataset.raw_dir}}/origin_INDICES" # keep the data sorting from the INDICES file
    onehot_gen: false
    onehot_range: [1, 101]
    get_parameters_from: "{{Dataset.MPDataset.processed_dir}}"
  MPDatasetLarge:
    processed_filename: CONFIG
    total_data_num: 41819
    processed_dir: "{{Process.processed_dir}}/mpl_neigbor_20_edge_30"
    get_parameters_from: "{{Dataset.MPDataset.processed_dir}}"
  HypoDataset: # Unoptimized Hypothesis Compounds
    processed_dir: "{{Process.processed_dir}}/hypo"
    scales: [0.96, 0.98, 1.00, 1.02, 1.04]
    atomic_numbers: [58, 27, 29]
    processed_filename: data # processed data filename
    processed_ase_filename: ase_data
    split_num: 10 # split dataset to multiple data block
    get_parameters_from: "{{Dataset.MPDataset.raw_dir}}"
  OptimizedHypoDataset: # Optimized Hypothesis Compounds
    raw_dir: "{{Process.raw_dir}}/opt_hypo"
    processed_dir: "{{Process.processed_dir}}/opt_hypo"
    onehot_gen: false
    onehot_range: [1, 101]
    total_num: 4542
    formation_energy_filename: FORMATION_ENERGY_
    compound_filename: POSCAR_
    get_parameters_from: "{{Dataset.OptimizedHypoDataset.raw_dir}}"

Models:
  ChemGNN:
    conv_params:
      aggregators: [sum, mean, min, max, std]
      scalers: [identity]
      edge_dim: "{{Process.edge.edge_feature}}"
      towers: 1
      pre_layers: 1
      post_layers: 1
      divide_input: false
      aggMLP: false
      aggMLP_factor: 0.5
    pre_fc_dim: [100]
    num_layers: 1
    conv_out_dim: 100
    post_fc_dim: [150, 100]
    dropout_rate: 0.0
    pool: "global_mean_pool"
    learning_rate: 0.02
    optimizer:
      name: AdamW
      params:
    scheduler:
      name: ReduceLROnPlateau
      params:
        mode: min
        factor: 0.85
        patience: 10
        min_lr: 0.00000001
  PNA:
    conv_params:
      aggregators: [sum, mean, min, max, std]
      scalers: [identity, amplification, attenuation]
      edge_dim: "{{Process.edge.edge_feature}}"
      towers: 1
      pre_layers: 1
      post_layers: 1
      divide_input: false
    pre_fc_dim: [100]
    num_layers: 1
    conv_out_dim: 100
    post_fc_dim: [150, 150]
    dropout_rate: 0.3
    pool: "global_mean_pool"
    learning_rate: 0.01
    optimizer:
      name: AdamW
      params:
    scheduler:
      name: ReduceLROnPlateau
      params:
        mode: min
        factor: 0.8
        patience: 30
        min_lr: 0.00000001
  GCN:
    conv_params:
      improved: true
    pre_fc_dim: [200, 200]
    num_layers: 2
    conv_out_dim: 100
    post_fc_dim: [200, 200]
    dropout_rate: 0.6
    pool: "global_mean_pool"
    learning_rate: 0.01
    optimizer:
      name: AdamW
      params:
    scheduler:
      name: ReduceLROnPlateau
      params:
        mode: min
        factor: 0.8
        patience: 30
        min_lr: 0.00000001
